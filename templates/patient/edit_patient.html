{% extends "main/base.html" %}
{% block title %}Edit Patient{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='styles/patient/forms.css') }}">
{% endblock %}
{% block content %}
<div class="container">
    <div class="header">
        <h1>Edit Patient</h1>
        <!-- <div class="header-actions">
            <a href="{{ url_for('patients.view_patient', patient_id=patient.id) }}" class="btn btn-secondary">Back</a>
        </div> -->
    </div>

    <form method="POST" class="form-container">
        <div class="form-row">
            <div class="form-group">
                <label for="first_name">First Name</label>
                <input type="text" id="first_name" name="first_name" value="{{ patient.first_name }}" required>
            </div>
            <div class="form-group">
                <label for="last_name">Last Name</label>
                <input type="text" id="last_name" name="last_name" value="{{ patient.last_name }}" required>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="date_of_birth">Date of Birth</label>
                <input type="date" id="date_of_birth" name="date_of_birth"
                    value="{{ patient.date_of_birth.strftime('%Y-%m-%d') if patient.date_of_birth else '' }}">
            </div>
            <div class="form-group">
                <label>Gender</label>
                <div style="display: flex; gap: 20px; margin-top: 10px;">
                    <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 0;">
                        <input type="radio" name="gender" value="male" {{ 'checked' if patient.gender and
                            patient.gender.value=='male' else '' }} style="margin-right: 8px; transform: scale(1.2);">
                        <span>Male</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 0;">
                        <input type="radio" name="gender" value="female" {{ 'checked' if patient.gender and
                            patient.gender.value=='female' else '' }} style="margin-right: 8px; transform: scale(1.2);">
                        <span>Female</span>
                    </label>
                    <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 0;">
                        <input type="radio" name="gender" value="other" {{ 'checked' if patient.gender and
                            patient.gender.value=='other' else '' }} style="margin-right: 8px; transform: scale(1.2);">
                        <span>Other</span>
                    </label>
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" value="{{ patient.email or '' }}">
            </div>
            <div class="form-group">
                <label for="phone_number">Phone Number</label>
                <input type="tel" id="phone_number" name="phone_number"
                    value="{{ patient.demographic_info.phone_number if patient.demographic_info and patient.demographic_info.phone_number else '' }}">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group full-width">
                <label for="address">Address</label>
                <textarea id="address" name="address" rows="3"
                    placeholder="Enter full address">{{ patient.demographic_info.address if patient.demographic_info and patient.demographic_info.address else '' }}</textarea>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group full-width">
                <label for="emergency_contact">Emergency Contact</label>
                <input type="text" id="emergency_contact" name="emergency_contact"
                    placeholder="Emergency contact name and phone number"
                    value="{{ patient.demographic_info.emergency_contact if patient.demographic_info and patient.demographic_info.emergency_contact else '' }}">
            </div>
        </div>

        <!-- Social History Section -->
        <div style="margin-top: 30px; padding-top: 30px; border-top: 2px solid #e9ecef;">
            <h3 style="color: #333; margin-bottom: 20px; font-size: 1.4rem; font-weight: 600;">Social History</h3>

            <div class="form-row">
                <div class="form-group">
                    <label for="drug_use">Drug Use</label>
                    <select id="drug_use" name="drug_use">
                        <option value="">Select drug use</option>
                        <option value="none" {% if patient.social_history and patient.social_history.drug_use and
                            patient.social_history.drug_use.value|lower=='none' %}selected{% endif %}>None</option>
                        <option value="recreational" {% if patient.social_history and patient.social_history.drug_use
                            and patient.social_history.drug_use.value|lower=='recreational' %}selected{% endif %}>
                            Recreational</option>
                        <option value="medical" {% if patient.social_history and patient.social_history.drug_use and
                            patient.social_history.drug_use.value|lower=='medical' %}selected{% endif %}>Medical
                        </option>
                        <option value="addictive" {% if patient.social_history and patient.social_history.drug_use and
                            patient.social_history.drug_use.value|lower=='addictive' %}selected{% endif %}>Addictive
                        </option>
                        <option value="other" {% if patient.social_history and patient.social_history.drug_use and
                            patient.social_history.drug_use.value|lower=='other' %}selected{% endif %}>Other</option>
                    </select>
                </div>


                <div class="form-group">
                    <label for="occupation">Occupation</label>
                    <input type="text" id="occupation" name="occupation" placeholder="Current occupation"
                        value="{{ patient.social_history.occupation if patient.social_history and patient.social_history.occupation else '' }}">
                </div>
                <div class="form-group">
                    <div style="display: flex; align-items: center; margin-bottom: 10px;">
                        <input type="checkbox" id="smoking_status" name="smoking_status" value="1" {% if
                            patient.social_history and patient.social_history.smoking_status %}checked{% endif %}
                            style="margin-right: 10px; transform: scale(1.2);">
                        <label for="smoking_status" style="margin-bottom: 0; cursor: pointer;">Smoking Status</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="alcohol_use">Alcohol Use</label>
                    <select id="alcohol_use" name="alcohol_use">
                        <option value="">Select alcohol use</option>

                        <option value="none" {% if patient.social_history and patient.social_history.alcohol_use and
                            patient.social_history.alcohol_use.value|lower=='none' %} selected {% endif %}>None</option>

                        <option value="light" {% if patient.social_history and patient.social_history.alcohol_use and
                            patient.social_history.alcohol_use.value|lower=='light' %} selected {% endif %}>Light
                        </option>

                        <option value="moderate" {% if patient.social_history and patient.social_history.alcohol_use and
                            patient.social_history.alcohol_use.value|lower=='moderate' %} selected {% endif %}>Moderate
                        </option>

                        <option value="heavy" {% if patient.social_history and patient.social_history.alcohol_use and
                            patient.social_history.alcohol_use.value|lower=='heavy' %} selected {% endif %}>Heavy
                        </option>
                    </select>
                </div>

            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-success">Update Patient</button>
                <a href="{{ url_for('patients.view_patient', patient_id=patient.id) }}"
                    class="btn btn-secondary">Cancel</a>
            </div>
    </form>
</div>

<script>
    // Set maximum date_of_birth to today (including current time)
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date_of_birth').max = today;

    document.addEventListener('DOMContentLoaded', function () {
        // Handle smoking status checkbox toggle
        document.getElementById('smoking_status').addEventListener('change', function () {
            const smokingDetails = document.getElementById('smoking_details');
            if (this.checked) {
                smokingDetails.style.display = 'block';
            } else {
                smokingDetails.style.display = 'none';
            }
        });

        // Show smoking details on page load if checkbox is checked
        if (document.getElementById('smoking_status').checked) {
            document.getElementById('smoking_details').style.display = 'block';
        }
    });
</script>
{% endblock %}